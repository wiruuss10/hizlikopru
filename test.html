<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HÄ±zlÄ± KÃ¶prÃ¼ Liste</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; padding: 15px; }
        .card { background: #1e1e1e; border-radius: 20px; padding: 25px; max-width: 400px; margin: auto; border: 1px solid #333; }
        .room-tag { color: #00bcd4; font-weight: bold; margin-bottom: 20px; display: block; font-size: 20px; }
        #history-list { margin-top: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg-item { background: #2a2a2a; padding: 15px; border-radius: 12px; border-left: 5px solid #00bcd4; text-align: left; }
        .btn { border: none; padding: 12px; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .download-link { background: #2e7d32; color: white; padding: 10px; display: block; border-radius: 8px; text-decoration: none; text-align: center; font-size: 14px; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="card">
        <span id="room-tag" class="room-tag">ODA BAÄLANILIYOR...</span>
        <button class="btn" style="background: #c0392b;" onclick="document.getElementById('fileInput').click()">ğŸ“ MOBÄ°LDEN DOSYA GÃ–NDER</button>
        <input type="file" id="fileInput" style="display:none" onchange="uploadFile(this)">
        <div id="history-list"></div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let roomID = urlParams.get('room') || prompt("Oda Ä°smi:");
        roomID = roomID.toLowerCase().trim().replace(/[^a-z0-9]/g, '');
        
        const messagesUrl = `https://hizlikopru-default-rtdb.europe-west1.firebasedatabase.app/${roomID}/messages.json`;
        let processedIds = new Set();
        document.getElementById('room-tag').innerText = `ODA: ${roomID.toUpperCase()}`;

        function fetchData() {
            fetch(`${messagesUrl}?limitToLast=10&nocache=${Date.now()}`)
            .then(res => res.json())
            .then(data => {
                if (!data) return;
                Object.keys(data).forEach(id => {
                    if (!processedIds.has(id) && data[id].sender === 'PC') {
                        processedIds.add(id);
                        renderMessage(data[id]);
                    }
                });
            });
        }

        function renderMessage(data) {
            const list = document.getElementById('history-list');
            const item = document.createElement('div');
            item.className = 'msg-item';
            
            if (data.type === 'image') {
                item.innerHTML = `<img src="${data.content}" style="max-width:100%; border-radius:8px;">`;
            } else if (data.type === 'file') {
                item.innerHTML = `<div>ğŸ“¦ <b>${data.filename}</b></div><a href="${data.content}" download="${data.filename}" class="download-link">ğŸ“¥ Ä°NDÄ°R</a>`;
            } else {
                item.innerHTML = `<div>${data.content}</div>`;
            }
            list.insertBefore(item, list.firstChild);
        }

        function uploadFile(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                fetch(messagesUrl, {
                    method: 'POST',
                    body: JSON.stringify({ content: e.target.result, filename: file.name, timestamp: Date.now()/1000, type: 'file', sender: 'WEB' })
                }).then(() => alert("GÃ¶nderildi!"));
            };
            reader.readAsDataURL(file);
        }

        setInterval(fetchData, 2000);
        fetchData();
    </script>
</body>
</html>
